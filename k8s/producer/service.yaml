# 파일 경로: k8s/producer/service.yaml
# Producer 서비스 노출 설정

apiVersion: v1
kind: Service
metadata:
  name: bss-producer-service
  namespace: bss-queue-system
  labels:
    app: bss-queue-pattern
    component: producer
    tier: frontend
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "9090"
    prometheus.io/path: "/metrics"
spec:
  type: ClusterIP
  selector:
    app: bss-queue-pattern
    component: producer
  ports:
  - name: http
    port: 80
    targetPort: 8000
    protocol: TCP
  - name: metrics
    port: 9090
    targetPort: 9090
    protocol: TCP
  - name: health
    port: 8080
    targetPort: 8080
    protocol: TCP
  sessionAffinity: None

---
# NodePort 서비스 (Minikube 환경에서 외부 접근용)
apiVersion: v1
kind: Service
metadata:
  name: bss-producer-nodeport
  namespace: bss-queue-system
  labels:
    app: bss-queue-pattern
    component: producer
    tier: frontend
    service-type: external
spec:
  type: NodePort
  selector:
    app: bss-queue-pattern
    component: producer
  ports:
  - name: http
    port: 80
    targetPort: 8000
    nodePort: 30080  # 외부에서 접근할 포트
    protocol: TCP
  - name: metrics
    port: 9090
    targetPort: 9090
    nodePort: 30090
    protocol: TCP